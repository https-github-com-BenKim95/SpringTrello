<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragment/head :: userHead ('메인페이지')}"></head>
<body>
<div class="container-eagle">
    <div th:replace="~{fragment/nav :: useNav}">insert</div>
<div class="board">
    <button class="add-list" th:attr="onclick='addList(' + ${board_id} + ')'">Add List</button>
</div>

<h1 th:text="${columns.title}">Default Title</h1>
<input type="hidden" th:value="${columns.boardId}" id="boardId"/>
<div class="columns-container">
    <div th:each="column : ${columns.columnLists}">
        <div class="column-box">
            <!-- 'x' 버튼 추가 -->
            <button class="delete-column" th:attr="onclick='deleteColumn(' + ${column.id} + ')'">x</button>

            <form method="get" action="/api/board/column_list">
                <input type="hidden" th:value="${columns.boardId}" th:id="${columns.boardId}" name="boardId">
                <input type="hidden" th:value="${column.id}" th:id="${column.id}" name="id">
                <input type="text" th:value="${column.title}" th:id="${column.title}" name="title">
                <button type="submit">확인</button>
            </form>

            <!-- 카드 -->
            <div>
            <!-- 카드 생성-->
                <form method="POST" action= "/api/board/column_list/card">
                    <input type="hidden" th:value="${columns.boardId}" name="boardId">
                    <input type="hidden" th:value="${column.id}"  name="columnId">
                    <input type="text"  name="title">
                    <button type="submit">확인</button>
                </form>

                <div th:each="card : ${column.cardLists}">
                    <div class="card-box">
                        <h3 th:text="${card.title}">Default Card Title</h3>
                        <p th:text="${card.description}">No description available.</p>
                        <p th:text="${card.createdAt}">Creation Date: N/A</p>
<!--                        <p th:text="${card.workerList}">Assigned Workers: None</p>-->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
<script>
    function addList() {
        const boardId = window.location.href.split('/').pop();

        const requestData = {
            title: "New Column" // 초기 제목 설정
        };

        $.ajax({
            url: `/api/board/${boardId}/column_list`,
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(requestData),
            success: function (responseData) {

                window.location.reload();
            },
            error: function () {
                alert('Failed to create column list.');
            }
        });
    }

    function deleteColumn(columnId) {
        const boardId = window.location.href.split('/').pop(); //주소창에서 boardId값 받아오기
        const columnDeId = columnId;
        $.ajax({
            // url: `/api/board/${boardId}/column_list/${columnId}`,
            url: `/api/board/${boardId}/column_list/${columnDeId}`,
            type: 'DELETE',
            contentType: 'application/json',
            success: function (responseData) {

                window.location.reload();
            },
            error: function () {
                alert('Failed to delete column list.');
            }
        });
    }
</script>

</body>
</html>


